<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaZi Chart Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #4f46e5;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-align: center;
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            position: relative;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        input, select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--text-primary);
            background-color: var(--card-background);
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            max-width: 300px;
            display: block;
            margin: 0 auto;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }

        .step {
            display: none;
            transition: opacity 0.3s ease;
        }

        .step.active {
            display: block;
        }

        .verification-code {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .verification-code input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
        }

        .results-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 1.5rem 0;
            background: var(--card-background);
            border-radius: 12px;
            overflow: hidden;
        }

        .results-table th, .results-table td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .results-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        .results-table tr:last-child td {
            border-bottom: none;
        }

        .results-table tr:hover td {
            background-color: rgba(99, 102, 241, 0.05);
        }

        .interpretation {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: rgba(99, 102, 241, 0.05);
            border-radius: 8px;
        }

        .email-input-group {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .email-input-group input {
            flex: 1;
        }

        .send-code-btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            width: auto;
            max-width: none;
            margin: 0;
        }

        .send-code-btn:disabled {
            background-color: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .verification-section {
            margin-top: 2rem;
        }

        .verification-code {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin: 1rem 0;
        }

        .verification-code input {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .verification-code input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .verification-hint {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 1rem;
        }

        .resend-timer {
            color: var(--primary-color);
            font-weight: 500;
            margin-top: 0.5rem;
        }

        .verify-btn {
            margin-top: 2rem;
            background-color: var(--primary-color);
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .verification-code {
                flex-wrap: wrap;
            }

            .email-input-group {
                flex-direction: column;
            }

            .send-code-btn {
                width: 100%;
            }

            .verification-code input {
                width: 50px;
                height: 50px;
                font-size: 1.25rem;
            }
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .bazi-chart {
            background: var(--card-background);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .chart-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .chart-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .chart-cell {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .elements-analysis {
            background: var(--card-background);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .elements-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .element-card {
            background: var(--background-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .element-card:hover {
            transform: translateY(-5px);
        }

        .element-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .element-name {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .element-percentage {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .detailed-analysis {
            background: var(--card-background);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .analysis-card {
            background: var(--background-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .analysis-card h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .recommendations {
            background: var(--card-background);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: var(--background-color);
            border-radius: 8px;
        }

        .recommendation-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .elements-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Step 1: Birth Information -->
        <div class="card step active" id="step1">
            <h1>BaZi Chart Analysis</h1>
            <form id="birthForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="birthYear">Birth Year</label>
                        <select id="birthYear" required>
                            <option value="">Select Year</option>
                            <!-- Years will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birthMonth">Birth Month</label>
                        <select id="birthMonth" required>
                            <option value="">Select Month</option>
                            <!-- Months will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birthDay">Birth Day</label>
                        <select id="birthDay" required>
                            <option value="">Select Day</option>
                            <!-- Days will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birthHour">Birth Hour</label>
                        <select id="birthHour" required>
                            <option value="">Select Hour</option>
                            <!-- Hours will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
                <button type="submit">Next: Email Verification</button>
            </form>
        </div>

        <!-- Step 2: Email Verification -->
        <div class="card step" id="step2">
            <h2>Email Verification</h2>
            <form id="emailForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <div class="email-input-group">
                        <input type="email" id="email" required placeholder="Enter your email">
                        <button type="button" id="sendCodeBtn" class="send-code-btn">Send Code</button>
                    </div>
                </div>
                <div class="verification-section">
                    <label>Verification Code</label>
                    <div class="verification-code">
                        <input type="text" maxlength="1" pattern="[0-9]" required>
                        <input type="text" maxlength="1" pattern="[0-9]" required>
                        <input type="text" maxlength="1" pattern="[0-9]" required>
                        <input type="text" maxlength="1" pattern="[0-9]" required>
                    </div>
                    <div class="verification-hint">
                        <p>Please enter the 4-digit code sent to your email</p>
                        <p class="resend-timer" id="resendTimer"></p>
                    </div>
                </div>
                <button type="submit" class="verify-btn">Verify Email</button>
            </form>
        </div>

        <!-- Step 3: Results -->
        <div class="card step" id="step3">
            <h2>Your BaZi Chart Analysis</h2>
            <div class="results-container">
                <!-- BaZi Chart Section -->
                <div class="bazi-chart">
                    <div class="chart-header">
                        <h3>BaZi Chart</h3>
                    </div>
                    <div class="chart-grid">
                        <div class="chart-column">
                            <div class="chart-label">Year</div>
                            <div class="chart-cell" id="yearStem"></div>
                            <div class="chart-cell" id="yearBranch"></div>
                        </div>
                        <div class="chart-column">
                            <div class="chart-label">Month</div>
                            <div class="chart-cell" id="monthStem"></div>
                            <div class="chart-cell" id="monthBranch"></div>
                        </div>
                        <div class="chart-column">
                            <div class="chart-label">Day</div>
                            <div class="chart-cell" id="dayStem"></div>
                            <div class="chart-cell" id="dayBranch"></div>
                        </div>
                        <div class="chart-column">
                            <div class="chart-label">Hour</div>
                            <div class="chart-cell" id="hourStem"></div>
                            <div class="chart-cell" id="hourBranch"></div>
                        </div>
                    </div>
                </div>

                <!-- Elements Analysis Section -->
                <div class="elements-analysis">
                    <h3>Five Elements Analysis</h3>
                    <div class="elements-grid">
                        <div class="element-card wood">
                            <div class="element-icon">🌳</div>
                            <div class="element-name">Wood</div>
                            <div class="element-percentage" id="woodPercentage">0%</div>
                        </div>
                        <div class="element-card fire">
                            <div class="element-icon">🔥</div>
                            <div class="element-name">Fire</div>
                            <div class="element-percentage" id="firePercentage">0%</div>
                        </div>
                        <div class="element-card earth">
                            <div class="element-icon">🌍</div>
                            <div class="element-name">Earth</div>
                            <div class="element-percentage" id="earthPercentage">0%</div>
                        </div>
                        <div class="element-card metal">
                            <div class="element-icon">⚔️</div>
                            <div class="element-name">Metal</div>
                            <div class="element-percentage" id="metalPercentage">0%</div>
                        </div>
                        <div class="element-card water">
                            <div class="element-icon">💧</div>
                            <div class="element-name">Water</div>
                            <div class="element-percentage" id="waterPercentage">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Analysis Section -->
                <div class="detailed-analysis">
                    <h3>Detailed Analysis</h3>
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4>Personality Traits</h4>
                            <p id="personalityTraits"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>Career Potential</h4>
                            <p id="careerPotential"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>Relationships</h4>
                            <p id="relationships"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>Health & Wellness</h4>
                            <p id="healthWellness"></p>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Section -->
                <div class="recommendations">
                    <h3>Recommendations</h3>
                    <div class="recommendations-list" id="recommendationsList">
                        <!-- Recommendations will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize year select (1900 to current year)
            const yearSelect = document.getElementById('birthYear');
            const currentYear = new Date().getFullYear();
            for (let year = 1900; year <= currentYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }

            // Initialize month select (1 to 12)
            const monthSelect = document.getElementById('birthMonth');
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthSelect.appendChild(option);
            }

            // Initialize hour select (子时 to 亥时)
            const hourSelect = document.getElementById('birthHour');
            const hours = [
                '子时 (11:00 PM - 1:00 AM)', '丑时 (1:00 AM - 3:00 AM)', 
                '寅时 (3:00 AM - 5:00 AM)', '卯时 (5:00 AM - 7:00 AM)',
                '辰时 (7:00 AM - 9:00 AM)', '巳时 (9:00 AM - 11:00 AM)',
                '午时 (11:00 AM - 1:00 PM)', '未时 (1:00 PM - 3:00 PM)',
                '申时 (3:00 PM - 5:00 PM)', '酉时 (5:00 PM - 7:00 PM)',
                '戌时 (7:00 PM - 9:00 PM)', '亥时 (9:00 PM - 11:00 PM)'
            ];
            hours.forEach((hour, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = hour;
                hourSelect.appendChild(option);
            });

            // Update days when month/year changes
            yearSelect.addEventListener('change', updateDays);
            monthSelect.addEventListener('change', updateDays);
            updateDays();

            // Handle birth form submission
            document.getElementById('birthForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const year = parseInt(document.getElementById('birthYear').value);
                const month = parseInt(document.getElementById('birthMonth').value);
                const day = parseInt(document.getElementById('birthDay').value);
                const hour = parseInt(document.getElementById('birthHour').value);
                
                // Calculate BaZi
                const bazi = calculateBaZi(year, month, day, hour);
                
                // Store the result for later use
                window.baziResult = bazi;
                
                showStep(2);
            });

            // Handle email form submission
            document.getElementById('emailForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const codeInputs = document.querySelectorAll('.verification-code input');
                const code = Array.from(codeInputs).map(input => input.value).join('');
                
                // 验证码为1234（演示用）
                if (code === '1234') {
                    const bazi = window.baziResult;
                    if (bazi) {
                        updateResultsTable(bazi);
                        showStep(3);
                    } else {
                        alert('Error: Birth information not found. Please try again.');
                    }
                } else {
                    alert('Invalid verification code. Please try again.');
                }
            });

            // 发送验证码按钮点击事件
            const sendCodeBtn = document.getElementById('sendCodeBtn');
            const resendTimer = document.getElementById('resendTimer');

            sendCodeBtn.addEventListener('click', function() {
                const email = document.getElementById('email').value;
                if (!email) {
                    alert('Please enter your email address');
                    return;
                }
                if (!isValidEmail(email)) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                // 禁用按钮并开始倒计时
                this.disabled = true;
                let countdown = 60;
                
                const timer = setInterval(() => {
                    resendTimer.textContent = `Resend code in ${countdown}s`;
                    countdown--;
                    
                    if (countdown < 0) {
                        clearInterval(timer);
                        this.disabled = false;
                        resendTimer.textContent = '';
                    }
                }, 1000);
                
                // 显示验证码（实际项目中应该通过邮件发送）
                alert('Verification code sent to your email: 1234');
            });

            // 验证邮箱格式
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Handle verification code inputs
            const codeInputs = document.querySelectorAll('.verification-code input');
            codeInputs.forEach((input, index) => {
                input.addEventListener('input', function(e) {
                    if (this.value.length === 1 && index < codeInputs.length - 1) {
                        codeInputs[index + 1].focus();
                    }
                });

                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !this.value && index > 0) {
                        codeInputs[index - 1].focus();
                    }
                });
            });
        });

        function updateDays() {
            const year = parseInt(document.getElementById('birthYear').value);
            const month = parseInt(document.getElementById('birthMonth').value);
            const daySelect = document.getElementById('birthDay');
            const daysInMonth = new Date(year, month, 0).getDate();

            daySelect.innerHTML = '<option value="">Select Day</option>';
            for (let day = 1; day <= daysInMonth; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day;
                daySelect.appendChild(option);
            }
        }

        function showStep(stepNumber) {
            // 隐藏所有步骤
            document.querySelectorAll('.step').forEach(step => {
                step.style.display = 'none';
            });
            
            // 显示目标步骤
            const targetStep = document.getElementById(`step${stepNumber}`);
            if (targetStep) {
                targetStep.style.display = 'block';
                // 添加淡入动画
                targetStep.style.opacity = '0';
                setTimeout(() => {
                    targetStep.style.opacity = '1';
                }, 10);
            }
        }

        function calculateBaZi(year, month, day, hour) {
            // 天干
            const heavenlyStems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
            // 地支
            const earthlyBranches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
            
            // 计算年柱
            const yearStem = heavenlyStems[(year - 4) % 10];
            const yearBranch = earthlyBranches[(year - 4) % 12];
            
            // 计算月柱
            const monthStem = heavenlyStems[(year * 2 + month) % 10];
            const monthBranch = earthlyBranches[(month - 1) % 12];
            
            // 计算日柱
            const dayStem = heavenlyStems[Math.floor((year * 5 + Math.floor(year / 4) + day) % 10)];
            const dayBranch = earthlyBranches[Math.floor((year * 5 + Math.floor(year / 4) + day) % 12)];
            
            // 计算时柱
            const hourStem = heavenlyStems[Math.floor((year * 2 + hour) % 10)];
            const hourBranch = earthlyBranches[hour % 12];
            
            return {
                year: { stem: yearStem, branch: yearBranch },
                month: { stem: monthStem, branch: monthBranch },
                day: { stem: dayStem, branch: dayBranch },
                hour: { stem: hourStem, branch: hourBranch }
            };
        }

        function updateResultsTable(bazi) {
            // Update BaZi Chart
            document.getElementById('yearStem').textContent = bazi.year.stem;
            document.getElementById('yearBranch').textContent = bazi.year.branch;
            document.getElementById('monthStem').textContent = bazi.month.stem;
            document.getElementById('monthBranch').textContent = bazi.month.branch;
            document.getElementById('dayStem').textContent = bazi.day.stem;
            document.getElementById('dayBranch').textContent = bazi.day.branch;
            document.getElementById('hourStem').textContent = bazi.hour.stem;
            document.getElementById('hourBranch').textContent = bazi.hour.branch;

            // Calculate and update elements
            const elements = calculateElements(bazi);
            const total = Object.values(elements).reduce((a, b) => a + b, 0);
            
            for (const [element, count] of Object.entries(elements)) {
                const percentage = Math.round((count / total) * 100);
                document.getElementById(`${element}Percentage`).textContent = `${percentage}%`;
            }

            // Generate detailed analysis
            generateDetailedAnalysis(bazi, elements);
        }

        function calculateElements(bazi) {
            const elements = {
                wood: 0,
                fire: 0,
                earth: 0,
                metal: 0,
                water: 0
            };
            
            // 天干五行对应
            const stemElements = {
                '甲': 'wood', '乙': 'wood',
                '丙': 'fire', '丁': 'fire',
                '戊': 'earth', '己': 'earth',
                '庚': 'metal', '辛': 'metal',
                '壬': 'water', '癸': 'water'
            };
            
            // 地支五行对应
            const branchElements = {
                '寅': 'wood', '卯': 'wood',
                '巳': 'fire', '午': 'fire',
                '辰': 'earth', '戌': 'earth', '丑': 'earth', '未': 'earth',
                '申': 'metal', '酉': 'metal',
                '亥': 'water', '子': 'water'
            };
            
            // 计算天干五行
            elements[stemElements[bazi.year.stem]] += 1;
            elements[stemElements[bazi.month.stem]] += 1;
            elements[stemElements[bazi.day.stem]] += 1;
            elements[stemElements[bazi.hour.stem]] += 1;
            
            // 计算地支五行
            elements[branchElements[bazi.year.branch]] += 1;
            elements[branchElements[bazi.month.branch]] += 1;
            elements[branchElements[bazi.day.branch]] += 1;
            elements[branchElements[bazi.hour.branch]] += 1;
            
            return elements;
        }

        function generateDetailedAnalysis(bazi, elements) {
            // Personality Traits
            const personalityTraits = generatePersonalityTraits(bazi, elements);
            document.getElementById('personalityTraits').textContent = personalityTraits;

            // Career Potential
            const careerPotential = generateCareerPotential(bazi, elements);
            document.getElementById('careerPotential').textContent = careerPotential;

            // Relationships
            const relationships = generateRelationships(bazi, elements);
            document.getElementById('relationships').textContent = relationships;

            // Health & Wellness
            const healthWellness = generateHealthWellness(bazi, elements);
            document.getElementById('healthWellness').textContent = healthWellness;

            // Generate recommendations
            generateRecommendations(bazi, elements);
        }

        function generatePersonalityTraits(bazi, elements) {
            const traits = [];
            const strongestElement = Object.entries(elements)
                .sort(([,a], [,b]) => b - a)[0][0];

            switch(strongestElement) {
                case 'wood':
                    traits.push("Creative and innovative thinker");
                    traits.push("Adaptable and flexible in approach");
                    traits.push("Strong sense of justice and fairness");
                    break;
                case 'fire':
                    traits.push("Passionate and enthusiastic");
                    traits.push("Natural leader with charisma");
                    traits.push("Quick decision maker");
                    break;
                case 'earth':
                    traits.push("Practical and reliable");
                    traits.push("Patient and nurturing");
                    traits.push("Strong sense of responsibility");
                    break;
                case 'metal':
                    traits.push("Precise and detail-oriented");
                    traits.push("Strong sense of justice");
                    traits.push("Determined and focused");
                    break;
                case 'water':
                    traits.push("Intuitive and insightful");
                    traits.push("Adaptable to change");
                    traits.push("Deep thinker and philosopher");
                    break;
            }

            return traits.join(". ");
        }

        function generateCareerPotential(bazi, elements) {
            const careers = [];
            const strongestElement = Object.entries(elements)
                .sort(([,a], [,b]) => b - a)[0][0];

            switch(strongestElement) {
                case 'wood':
                    careers.push("Creative industries");
                    careers.push("Environmental work");
                    careers.push("Education and training");
                    break;
                case 'fire':
                    careers.push("Leadership roles");
                    careers.push("Sales and marketing");
                    careers.push("Entertainment industry");
                    break;
                case 'earth':
                    careers.push("Real estate");
                    careers.push("Agriculture");
                    careers.push("Healthcare");
                    break;
                case 'metal':
                    careers.push("Finance and banking");
                    careers.push("Law and justice");
                    careers.push("Engineering");
                    break;
                case 'water':
                    careers.push("Research and analysis");
                    careers.push("Counseling and therapy");
                    careers.push("Technology and innovation");
                    break;
            }

            return `Your career potential aligns with ${careers.join(", ")}. Your natural talents and inclinations suggest success in these fields.`;
        }

        function generateRelationships(bazi, elements) {
            const relationships = [];
            const strongestElement = Object.entries(elements)
                .sort(([,a], [,b]) => b - a)[0][0];

            const interpretation = generateInterpretation(elements);
            relationships.push(interpretation);

            return relationships.join(". ");
        }

        function generateInterpretation(elements) {
            const total = Object.values(elements).reduce((a, b) => a + b, 0);
            const percentages = {};
            
            for (const [element, count] of Object.entries(elements)) {
                percentages[element] = Math.round((count / total) * 100);
            }
            
            let interpretation = "Your BaZi chart shows ";
            
            // 找出最强的五行
            const strongestElement = Object.entries(percentages)
                .sort(([,a], [,b]) => b - a)[0];
            
            interpretation += `a strong presence of ${strongestElement[0]} element (${strongestElement[1]}%)`;
            
            // 添加五行相生相克关系
            const relationships = {
                wood: { generates: 'fire', controls: 'earth' },
                fire: { generates: 'earth', controls: 'metal' },
                earth: { generates: 'metal', controls: 'water' },
                metal: { generates: 'water', controls: 'wood' },
                water: { generates: 'wood', controls: 'fire' }
            };
            
            const supportingElement = relationships[strongestElement[0]].generates;
            const controlledElement = relationships[strongestElement[0]].controls;
            
            interpretation += `, suggesting ${getElementTraits(strongestElement[0])}. `;
            interpretation += `The ${supportingElement} element (${percentages[supportingElement]}%) supports your ${strongestElement[0]} energy, `;
            interpretation += `while the ${controlledElement} element (${percentages[controlledElement]}%) is controlled by it. `;
            
            return interpretation;
        }

        function getElementTraits(element) {
            const traits = {
                wood: "creativity, growth, and flexibility",
                fire: "passion, leadership, and transformation",
                earth: "stability, practicality, and nurturing",
                metal: "precision, determination, and justice",
                water: "wisdom, adaptability, and mystery"
            };
            return traits[element];
        }
    </script>
</body>
</html> 